# CLAUDE.MD

このファイルは、Claudeがこのプロジェクトを理解し、効果的に作業するためのガイドです。

## プロジェクト概要

**プロジェクト名:** Req_Define_Document_Maker_For_Claude

**説明:**
Claudeに依頼するための要求仕様書を作成するツール。ユーザーが効率的かつ明確にプロジェクト要件を定義し、Claudeとの対話をスムーズに開始できるようにする。

**主要な目標:**
- ユーザーが要件を体系的に整理できるフォームを提供
- 「お任せ」「別途議論」オプションで柔軟な要件定義を実現
- Claude向けの最適化されたプロンプトを自動生成
- Markdown形式の要求仕様書を出力

## 技術スタック

### 現在のプロトタイプ（Webアプリ版）

**言語:**
- HTML5
- CSS3
- JavaScript (Vanilla)

**フレームワーク/ライブラリ:**
- なし（Pure HTML/CSS/JS）

**ツール:**
- ブラウザ（Chrome, Edge, Firefox等）

### デスクトップアプリ版

**言語:**
- C#

**フレームワーク:**
- WPF (Windows Presentation Foundation)
- .NET 8

## プロジェクト構造

```
/
├── WebApp/              # Webアプリ版
│   ├── index.html      # メインHTML（フォーム画面）
│   ├── style.css       # スタイルシート
│   ├── script.js       # メインロジック（イベント処理、UI制御）
│   └── template.js     # テンプレート生成（要求仕様書、プロンプト）
├── DesktopApp/          # C# WPFデスクトップアプリ版
│   └── ReqDefineDocumentMaker/
│       ├── App.xaml                   # アプリケーションリソース定義
│       ├── App.xaml.cs                # アプリケーションエントリーポイント
│       ├── MainWindow.xaml            # UIデザイン（XAML）
│       ├── MainWindow.xaml.cs         # UIロジック（コードビハインド）
│       ├── TemplateGenerator.cs       # テンプレート生成クラス
│       └── ReqDefineDocumentMaker.csproj  # プロジェクトファイル
├── Specifications/      # 仕様書
│   ├── WebApp_Specification.md        # Webアプリ版仕様書
│   └── DesktopApp_Specification.md    # デスクトップアプリ版仕様書
├── CLAUDE.MD            # このファイル
└── README.md            # プロジェクト概要と使い方
```

## 機能仕様

### ユーザーワークフロー

**Step1: 要件入力**
- ユーザーが予め決まっている要件を入力または選択
- 決まっていない要件は「お任せ」「別途議論を希望」を選択可能

**Step2: 一次要求仕様書生成**
- ツールがStep1の内容で一次要求仕様書（Markdown）を作成
- Claude向けプロンプトも同時に出力

**Step3: Claudeへ依頼**
- プロンプト入力欄に直接入力、または
- ファイルとして保存してClaude Codeに読み込ませる

**Step4: 議論と二次要求仕様書作成**
- 必要な議論を交わした上で、Claudeが二次要求仕様書を作成

**Step5: 次のアクション選択**
- このまま実装に入る、または
- 終了する（後日改めて依頼する場合など）

### 要求仕様書のテンプレート項目

**1. 基本情報**
- プロジェクト名
- 概要/目的
- 対象ユーザー

**2. 技術要件**
- アプリケーション種類（CLI/デスクトップ/Web/その他）
- 使用言語
- フレームワーク/ライブラリ
- 開発環境
- 本番環境（「開発環境と同じ」の選択肢あり）
- 制約事項

**3. 機能要件**
- 主要機能
- 画面/UI要件
- データ要件

**4. その他**
- 参考資料

### 主な機能

- 各項目の入力フォーム
- 「お任せ」「別途議論」ボタン（押すと入力欄が無効化）
- 一次要求仕様書の自動生成（Markdown形式）
- Claude向けプロンプトの自動生成
- クリップボードコピー機能
- ファイル保存機能（.md形式）
- ダークモード切り替え機能（設定を保存）

## 開発ガイドライン

### コーディング規約

- **命名規則:** キャメルケース（JavaScript）、ケバブケース（CSS）
- **インデント:** スペース4つ
- **コメント:** 日本語で記述、複雑なロジックには必ず説明を付ける

### コミット規約

```
<type>: <subject>

<body>

<footer>
```

**Type:**
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの意味に影響しない変更（空白、フォーマットなど）
- `refactor`: リファクタリング
- `test`: テストの追加や修正
- `chore`: ビルドプロセスやツールの変更

## Claude向けの指示

### 優先事項

1. **シンプルさ:** ユーザーが使いやすいUIとわかりやすいコードを優先
2. **柔軟性:** ユーザーの要件定義スタイルに柔軟に対応
3. **ドキュメント:** コードの変更に合わせてCLAUDE.MDも更新

### 作業フロー

1. 既存のコードを理解するため、関連ファイルを読む
2. 変更前に影響範囲を確認（特にtemplate.jsの出力フォーマット）
3. 段階的に実装し、各ステップで動作確認
4. ユーザーにフィードバックを求める

### 避けるべきこと

- 過度な抽象化や不必要な複雑さの導入
- 要求されていない機能の追加
- 既存のシンプルなコード構造を複雑化すること
- デザインの過度な装飾（シンプルで実用的なUIを維持）

### 重要なファイル

**Webアプリ版:**
- `WebApp/index.html` - メインのUI。フォーム構造を定義
- `WebApp/template.js` - 要求仕様書とプロンプトの生成ロジック。出力フォーマットの中核
- `WebApp/script.js` - UIの動作制御。イベント処理とデータ収集
- `WebApp/style.css` - スタイル定義。レスポンシブ対応を含む

**デスクトップアプリ版:**
- `DesktopApp/ReqDefineDocumentMaker/MainWindow.xaml` - UI定義（XAML）。フォーム構造、スタイル、ダークモード対応
- `DesktopApp/ReqDefineDocumentMaker/MainWindow.xaml.cs` - UIロジック。イベント処理、データ収集、テーマ管理
- `DesktopApp/ReqDefineDocumentMaker/TemplateGenerator.cs` - 要求仕様書とプロンプトの生成ロジック
- `DesktopApp/ReqDefineDocumentMaker/App.xaml` - アプリケーションリソース。テーマカラー定義

**共通:**
- `CLAUDE.MD` - このファイル。プロジェクトの全体像を記述
- `README.md` - プロジェクト概要と使い方

**仕様書:**
- `Specifications/WebApp_Specification.md` - Webアプリ版の詳細仕様書
- `Specifications/DesktopApp_Specification.md` - デスクトップアプリ版の詳細仕様書

## セットアップ手順

### Webアプリ版（現在のプロトタイプ）

1. プロジェクトフォルダを開く
2. `index.html` をブラウザで開く（ダブルクリック）
3. 以上！（依存関係なし、インストール不要）

### C#デスクトップアプリ版

```bash
# プロジェクトディレクトリに移動
cd DesktopApp/ReqDefineDocumentMaker

# ビルド
dotnet build

# 実行
dotnet run
```

または、Visual Studioでプロジェクトを開いて実行することもできます。

## 使い方

1. **要件入力**
   - 各項目に要件を入力
   - または「お任せ」「別途議論」ボタンをクリック

2. **生成**
   - 「要求仕様書を生成」ボタンをクリック

3. **出力の利用**
   - **クリップボードにコピー**: Claudeに直接貼り付ける場合
   - **ファイル保存**: 後でClaude Codeに読み込ませる場合

4. **Claudeへ依頼**
   - コピーした内容をClaude Codeのプロンプト欄に貼り付け、または
   - 保存したファイルをClaude Codeに読み込ませる

## 開発状況

### 完了
- ✅ 要求仕様書テンプレート項目の確定
- ✅ Webアプリのプロトタイプ作成
- ✅ 基本機能の実装（入力、生成、コピー、保存）
- ✅ C# WPF (.NET 8) デスクトップアプリの実装
- ✅ フォルダ構造の整理（WebApp/とDesktopApp/に分離）
- ✅ クリップボードコピーの問題解決（TextBoxBase.Copy()を使用）
- ✅ ダークモード機能の実装（Web版・デスクトップ版両方）

### 今後の可能性
- 過去の仕様書の保存・読み込み機能
- テンプレートのカスタマイズ機能
- プロジェクトタイプ別のプリセット
- デスクトップアプリへの追加機能（プリセット保存など）

## トラブルシューティング

### よくある問題

**問題: 「お任せ」「別途議論」ボタンを押したが、入力欄に戻せない**

解決方法: もう一度同じボタンをクリックすると解除されます。

**問題（Webアプリ版）: ファイル保存ができない**

解決方法: ブラウザのダウンロード設定を確認してください。ポップアップブロックが有効な場合は無効化してください。

**問題（Webアプリ版）: クリップボードにコピーできない**

解決方法: ブラウザのクリップボード権限を許可してください。HTTPSでない場合は動作しないことがあります。

**問題（デスクトップアプリ版）: アプリが起動しない**

解決方法: .NET 8 ランタイムがインストールされているか確認してください。Process Monitorなどのツールでクラッシュ原因を調査できます。

**問題（デスクトップアプリ版）: クリップボードコピーでエラーが発生する（環境依存）**

原因: ウイルス対策ソフトの「クリップボード保護」機能が干渉している可能性があります。

解決方法:
- 現在の実装では`TextBoxBase.Copy()`を使用しており、ほとんどの環境でエラーは発生しません
- それでもエラーが発生する場合は、ウイルス対策ソフトのクリップボード保護機能を一時的に無効化するか、「ファイル保存」機能をご利用ください

**技術メモ（開発者向け）:**

**クリップボード操作:**
- クリップボードAPIを直接使用（`Clipboard.SetText()`や`Clipboard.SetDataObject()`）すると、ウイルス対策ソフトのクリップボード保護機能（特にブラウザ関連の保護）との競合が発生する場合があります
- `TextBoxBase.Copy()`を使用することで、WPFコントロール経由でクリップボードにアクセスし、競合を回避できます
- 実装例: `textBox.SelectAll(); textBox.Copy();`

**ダークモード実装:**
- Web版: CSS変数（`--bg-primary`等）を使用し、`body.dark-mode`クラスで色を上書き。設定はローカルストレージに保存
- デスクトップ版: `DynamicResource`を使用してリソースディクショナリの色を動的に変更。ComboBoxとTabItemはカスタムテンプレートで完全対応。設定はレジストリ `HKEY_CURRENT_USER\Software\hirosof\ReqDefineDocumentMakerForClaude` に保存

## 更新履歴

- 2025-12-27: プロジェクト開始、Webアプリプロトタイプ作成
- 2025-12-27: CLAUDE.MD 初版作成
- 2025-12-27: フィードバック反映（アプリケーション種類追加、言語/フレームワーク分離、セクション順序変更）
- 2025-12-27: 環境を開発環境と本番環境に分離、本番環境に「開発環境と同じ」選択肢追加
- 2025-12-27: フォルダ構造整理（WebApp/とDesktopApp/に分離）
- 2025-12-27: C# WPF (.NET 8) デスクトップアプリの実装完了
- 2025-12-27: 起動時クラッシュの修正（ComboBox SelectionChangedイベントの初期化前発火問題）
- 2025-12-27: クリップボードコピーの問題解決（TextBoxBase.Copy()を使用してウイルス対策ソフトとの競合を回避）
- 2025-12-27: ダークモード機能の実装（Web版はローカルストレージ、デスクトップ版はレジストリ `Software\hirosof\ReqDefineDocumentMakerForClaude` に設定を保存）
- 2025-12-27: デスクトップアプリのダークモード改善（ComboBox・TabItemのカスタムテンプレート実装、背景色と文字色の完全対応）
- 2025-12-27: 詳細仕様書の作成（Specificationsフォルダに Web版・デスクトップ版を分けて作成）
